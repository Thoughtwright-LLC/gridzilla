<!DOCTYPE html>

<html>
<head>
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">

<title>module Gridzilla::View::InstanceMethods - RDoc Documentation</title>

<link type="text/css" media="screen" href="../../rdoc.css" rel="stylesheet">

<script type="text/javascript">
  var rdoc_rel_prefix = "../../";
</script>

<script type="text/javascript" charset="utf-8" src="../../js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="../../js/navigation.js"></script>
<script type="text/javascript" charset="utf-8" src="../../js/search_index.js"></script>
<script type="text/javascript" charset="utf-8" src="../../js/search.js"></script>
<script type="text/javascript" charset="utf-8" src="../../js/searcher.js"></script>
<script type="text/javascript" charset="utf-8" src="../../js/darkfish.js"></script>


<body id="top" class="module">
<nav id="metadata">
  <nav id="home-section" class="section">
  <h3 class="section-header">
    <a href="../../index.html">Home</a>
    <a href="../../table_of_contents.html#classes">Classes</a>
    <a href="../../table_of_contents.html#methods">Methods</a>
  </h3>
</nav>


  <nav id="search-section" class="section project-section" class="initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <h3 class="section-header">
      <input type="text" name="search" placeholder="Search" id="search-field"
             title="Type to search, Up and Down to navigate, Enter to load">
    </h3>
  </form>

  <ul id="search-results" class="initially-hidden"></ul>
</nav>


  

  <div id="file-metadata">
    <nav id="file-list-section" class="section">
  <h3 class="section-header">Defined In</h3>
  <ul>
    <li>lib/gridzilla/dsl.rb
  </ul>
</nav>

    
  </div>

  <div id="class-metadata">
    
    
    
    
    <!-- Method Quickref -->
<nav id="method-list-section" class="section">
  <h3 class="section-header">Methods</h3>

  <ul class="link-list">
    
    <li ><a href="#method-i-ajax_grid">#ajax_grid</a>
    
    <li ><a href="#method-i-grid">#grid</a>
    
  </ul>
</nav>

  </div>

  <div id="project-metadata">
    <nav id="fileindex-section" class="section project-section">
  <h3 class="section-header">Pages</h3>

  <ul>
  
    <li class="file"><a href="../../CHANGELOG_md.html">CHANGELOG</a>
  
    <li class="file"><a href="../../Gemfile.html">Gemfile</a>
  
    <li class="file"><a href="../../Gemfile_lock.html">Gemfile.lock</a>
  
    <li class="file"><a href="../../MIT-LICENSE.html">MIT-LICENSE</a>
  
    <li class="file"><a href="../../README_md.html">README</a>
  
    <li class="file"><a href="../../Rakefile.html">Rakefile</a>
  
    <li class="file"><a href="../../doc/ActionController_html.html">ActionController.html</a>
  
    <li class="file"><a href="../../doc/ActionView_html.html">ActionView.html</a>
  
    <li class="file"><a href="../../doc/BlankSlate_html.html">BlankSlate.html</a>
  
    <li class="file"><a href="../../doc/CHANGELOG_md_html.html">CHANGELOG_md.html</a>
  
    <li class="file"><a href="../../doc/Gemfile_html.html">Gemfile.html</a>
  
    <li class="file"><a href="../../doc/Gemfile_lock_html.html">Gemfile_lock.html</a>
  
    <li class="file"><a href="../../doc/Gridzilla_html.html">Gridzilla.html</a>
  
    <li class="file"><a href="../../doc/Gridzilla/Controller_html.html">Controller.html</a>
  
    <li class="file"><a href="../../doc/Gridzilla/Controller/ClassMethods_html.html">ClassMethods.html</a>
  
    <li class="file"><a href="../../doc/Gridzilla/Controller/GridBuilder_html.html">GridBuilder.html</a>
  
    <li class="file"><a href="../../doc/Gridzilla/Css_html.html">Css.html</a>
  
    <li class="file"><a href="../../doc/Gridzilla/Generators_html.html">Generators.html</a>
  
    <li class="file"><a href="../../doc/Gridzilla/Generators/InstallGenerator_html.html">InstallGenerator.html</a>
  
    <li class="file"><a href="../../doc/Gridzilla/Gobbler_html.html">Gobbler.html</a>
  
    <li class="file"><a href="../../doc/Gridzilla/Message_html.html">Message.html</a>
  
    <li class="file"><a href="../../doc/Gridzilla/PaginationLinkRenderer_html.html">PaginationLinkRenderer.html</a>
  
    <li class="file"><a href="../../doc/Gridzilla/View_html.html">View.html</a>
  
    <li class="file"><a href="../../doc/Gridzilla/View/AjaxGrid_html.html">AjaxGrid.html</a>
  
    <li class="file"><a href="../../doc/Gridzilla/View/Grid_html.html">Grid.html</a>
  
    <li class="file"><a href="../../doc/Gridzilla/View/InstanceMethods_html.html">InstanceMethods.html</a>
  
    <li class="file"><a href="../../doc/Gridzilla/View/Panel_html.html">Panel.html</a>
  
    <li class="file"><a href="../../doc/Gridzilla/View/Row_html.html">Row.html</a>
  
    <li class="file"><a href="../../doc/Gridzilla/ViewDsl_html.html">ViewDsl.html</a>
  
    <li class="file"><a href="../../doc/Gridzilla/ViewDsl/Base_html.html">Base.html</a>
  
    <li class="file"><a href="../../doc/GridzillaTest_html.html">GridzillaTest.html</a>
  
    <li class="file"><a href="../../doc/Kernel_html.html">Kernel.html</a>
  
    <li class="file"><a href="../../doc/MIT-LICENSE_html.html">MIT-LICENSE.html</a>
  
    <li class="file"><a href="../../doc/Mime_html.html">Mime.html</a>
  
    <li class="file"><a href="../../doc/Module_html.html">Module.html</a>
  
    <li class="file"><a href="../../doc/Object_html.html">Object.html</a>
  
    <li class="file"><a href="../../doc/README_md_html.html">README_md.html</a>
  
    <li class="file"><a href="../../doc/Rakefile_html.html">Rakefile.html</a>
  
    <li class="file"><a href="../../doc/String_html.html">String.html</a>
  
    <li class="file"><a href="../../doc/Symbol_html.html">Symbol.html</a>
  
    <li class="file"><a href="../../doc/created_rid.html">created.rid</a>
  
    <li class="file"><a href="../../doc/doc/created_rid_html.html">created_rid.html</a>
  
    <li class="file"><a href="../../doc/gridzilla_gemspec_html.html">gridzilla_gemspec.html</a>
  
    <li class="file"><a href="../../doc/index_html.html">index.html</a>
  
    <li class="file"><a href="../../doc/js/darkfish_js.html">darkfish.js</a>
  
    <li class="file"><a href="../../doc/js/jquery_js.html">jquery.js</a>
  
    <li class="file"><a href="../../doc/js/navigation_js.html">navigation.js</a>
  
    <li class="file"><a href="../../doc/js/search_js.html">search.js</a>
  
    <li class="file"><a href="../../doc/js/search_index_js.html">search_index.js</a>
  
    <li class="file"><a href="../../doc/js/searcher_js.html">searcher.js</a>
  
    <li class="file"><a href="../../doc/lib/generators/gridzilla/javascripts/jquery_blockUI_js_html.html">jquery_blockUI_js.html</a>
  
    <li class="file"><a href="../../doc/lib/generators/gridzilla/stylesheets/gridzilla_sass_html.html">gridzilla_sass.html</a>
  
    <li class="file"><a href="../../doc/lib/tasks/install_rake_html.html">install_rake.html</a>
  
    <li class="file"><a href="../../doc/rdoc_css.html">rdoc.css</a>
  
    <li class="file"><a href="../../doc/table_of_contents_html.html">table_of_contents.html</a>
  
    <li class="file"><a href="../../gridzilla_gemspec.html">gridzilla.gemspec</a>
  
    <li class="file"><a href="../../lib/generators/gridzilla/javascripts/jquery_blockUI_js.html">jquery.blockUI.js</a>
  
    <li class="file"><a href="../../lib/generators/gridzilla/stylesheets/gridzilla_sass.html">gridzilla.sass</a>
  
    <li class="file"><a href="../../lib/tasks/install_rake.html">install.rake</a>
  
  </ul>
</nav>

    <nav id="classindex-section" class="section project-section">
  <h3 class="section-header">Class and Module Index</h3>

  <ul class="link-list">
  
    <li><a href="../../ActionController.html">ActionController</a>
  
    <li><a href="../../ActionView.html">ActionView</a>
  
    <li><a href="../../BlankSlate.html">BlankSlate</a>
  
    <li><a href="../../BlankSlate.html">BlankSlate</a>
  
    <li><a href="../../Gridzilla.html">Gridzilla</a>
  
    <li><a href="../../Gridzilla/Controller.html">Gridzilla::Controller</a>
  
    <li><a href="../../Gridzilla/Controller/ClassMethods.html">Gridzilla::Controller::ClassMethods</a>
  
    <li><a href="../../Gridzilla/Controller/GridBuilder.html">Gridzilla::Controller::GridBuilder</a>
  
    <li><a href="../../Gridzilla/Css.html">Gridzilla::Css</a>
  
    <li><a href="../../Gridzilla/Generators.html">Gridzilla::Generators</a>
  
    <li><a href="../../Gridzilla/Generators/InstallGenerator.html">Gridzilla::Generators::InstallGenerator</a>
  
    <li><a href="../../Gridzilla/Gobbler.html">Gridzilla::Gobbler</a>
  
    <li><a href="../../Gridzilla/Message.html">Gridzilla::Message</a>
  
    <li><a href="../../Gridzilla/PaginationLinkRenderer.html">Gridzilla::PaginationLinkRenderer</a>
  
    <li><a href="../../Gridzilla/View.html">Gridzilla::View</a>
  
    <li><a href="../../Gridzilla/View/AjaxGrid.html">Gridzilla::View::AjaxGrid</a>
  
    <li><a href="../../Gridzilla/View/Grid.html">Gridzilla::View::Grid</a>
  
    <li><a href="../../Gridzilla/View/InstanceMethods.html">Gridzilla::View::InstanceMethods</a>
  
    <li><a href="../../Gridzilla/View/Panel.html">Gridzilla::View::Panel</a>
  
    <li><a href="../../Gridzilla/View/Row.html">Gridzilla::View::Row</a>
  
    <li><a href="../../Gridzilla/ViewDsl.html">Gridzilla::ViewDsl</a>
  
    <li><a href="../../Gridzilla/ViewDsl/Base.html">Gridzilla::ViewDsl::Base</a>
  
    <li><a href="../../GridzillaTest.html">GridzillaTest</a>
  
    <li><a href="../../Kernel.html">Kernel</a>
  
    <li><a href="../../Mime.html">Mime</a>
  
    <li><a href="../../Module.html">Module</a>
  
    <li><a href="../../Object.html">Object</a>
  
    <li><a href="../../String.html">String</a>
  
    <li><a href="../../Symbol.html">Symbol</a>
  
  </ul>
</nav>

  </div>
</nav>

<div id="documentation">
  <h1 class="module">module Gridzilla::View::InstanceMethods</h1>

  <div id="description" class="description">
    
  </div><!-- description -->

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    

    

    <!-- Methods -->
    
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section section">
      <h3 class="section-header">Public Instance Methods</h3>

    
      <div id="method-i-ajax_grid" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">ajax_grid</span><span
            class="method-args">(collection, *args, &block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="ajax_grid-source">
            <pre><span class="ruby-comment"># File lib/gridzilla/dsl.rb, line 446</span>
      <span class="ruby-keyword">def</span> <span class="ruby-identifier">ajax_grid</span>(<span class="ruby-identifier">collection</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
        <span class="ruby-identifier">options</span> = <span class="ruby-identifier">args</span>.<span class="ruby-identifier">extract_options!</span>

        <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>, <span class="ruby-string">&quot;Missing block in ajax_grid definition&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">block_given?</span>

        <span class="ruby-ivar">@gridzilla</span> <span class="ruby-operator">||=</span> []
        <span class="ruby-ivar">@gridzilla</span>.<span class="ruby-identifier">push</span>({})
        <span class="ruby-ivar">@gridzilla</span>.<span class="ruby-identifier">last</span>[<span class="ruby-value">:grid_controller</span>] = <span class="ruby-identifier">params</span>[<span class="ruby-value">:controller</span>]
        <span class="ruby-ivar">@gridzilla</span>.<span class="ruby-identifier">last</span>[<span class="ruby-value">:grid_name</span>]       = <span class="ruby-identifier">options</span>[<span class="ruby-value">:grid_name</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:action</span>][<span class="ruby-value">0</span><span class="ruby-operator">..</span><span class="ruby-value">-6</span>] <span class="ruby-comment"># MAGIC_NUMBER(-6) removes the _grid on the action name</span>
        <span class="ruby-ivar">@gridzilla</span>.<span class="ruby-identifier">last</span>[<span class="ruby-value">:collection</span>]      = <span class="ruby-identifier">collection</span>
        <span class="ruby-ivar">@gridzilla</span>.<span class="ruby-identifier">last</span>[<span class="ruby-value">:selected_items</span>]  = <span class="ruby-identifier">options</span>[<span class="ruby-value">:selected_items</span>]
        <span class="ruby-ivar">@gridzilla</span>.<span class="ruby-identifier">last</span>[<span class="ruby-value">:multi_page_selector</span>] = <span class="ruby-identifier">options</span>[<span class="ruby-value">:multi_page_selector</span>]
        <span class="ruby-identifier">view_dsl</span> = <span class="ruby-constant">Gridzilla</span><span class="ruby-operator">::</span><span class="ruby-constant">ViewDsl</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">new</span>(<span class="ruby-constant">Gridzilla</span><span class="ruby-operator">::</span><span class="ruby-constant">View</span><span class="ruby-operator">::</span><span class="ruby-constant">AjaxGrid</span>.<span class="ruby-identifier">new</span>(<span class="ruby-keyword">self</span>), <span class="ruby-keyword">self</span>)
        <span class="ruby-identifier">view_dsl</span>.<span class="ruby-identifier">instance_eval</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)

        <span class="ruby-identifier">concat</span>(<span class="ruby-identifier">content_tag</span>(<span class="ruby-value">:script</span>, <span class="ruby-string">&quot;          gridzilla.set_option('#{@gridzilla.last[:grid_name].html_safe}', 'controller', #{@gridzilla.last[:grid_controller].to_json.html_safe});
          gridzilla.set_option('#{@gridzilla.last[:grid_name].html_safe}', 'params', #{request.query_parameters.to_json.html_safe});
          gridzilla.set_option('#{@gridzilla.last[:grid_name].html_safe}', 'single_select', #{(!!@gridzilla.last[:single_select]).to_json.html_safe});
          gridzilla.set_option('#{@gridzilla.last[:grid_name].html_safe}', 'multi_page_selected', false);
&quot;</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-keyword">false</span>))

        <span class="ruby-identifier">concat</span>(<span class="ruby-identifier">content_tag</span>(<span class="ruby-value">:script</span>,<span class="ruby-string">&quot;          gridzilla.set_option('#{@gridzilla.last[:grid_name].html_safe}', 'multi_page_selector',#{options[:multi_page_selector].to_json.html_safe});
          gridzilla.set_option('#{@gridzilla.last[:grid_name].html_safe}', 'total_records',#{collection.total_entries.to_json.html_safe});
&quot;</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-keyword">false</span>)) <span class="ruby-keyword">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:multi_page_selector</span>]

        <span class="ruby-ivar">@gridzilla</span>.<span class="ruby-identifier">pop</span>
      <span class="ruby-keyword">end</span></pre>
          </div><!-- ajax_grid-source -->
          
        </div>

        

        
      </div><!-- ajax_grid-method -->

    
      <div id="method-i-grid" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">grid</span><span
            class="method-args">(name, *args, &block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Top level DSL method that places the grid in a page.  If the grid has a
block then it is a static grid.  Otherwise, it is the place holder for an
ajax grid.</p>

<p>Common Options:</p>
<ul><li>
<p>class - css class applied to the grid container.</p>
</li><li>
<p>data - hash that will be used as context within the grid.</p>
</li><li>
<p>height - set the height of the grid.</p>
</li></ul>

<h3 id="method-i-grid-label-Ajax">Ajax<span><a href="#method-i-grid-label-Ajax">&para;</a> <a href="#documentation">&uarr;</a></span></h3>

<p>grid(name, options)</p>

<p>name is the html id of the top level grid container.</p>

<p>Options:</p>
<ul><li>
<p>lazy - determines whether or not the grid loads automatically.</p>
</li><li>
<p>url - url to make ajax requests to when paginating the grid.  TODO: Seems
like there should be a better way to do this.  This is associated with the
.grid template type.</p>
</li></ul>

<h3 id="method-i-grid-label-Static">Static<span><a href="#method-i-grid-label-Static">&para;</a> <a href="#documentation">&uarr;</a></span></h3>

<p>grid (name, collection, options, &amp;block)</p>

<p>name is the html id of the top level grid container. collection is the list
of items to be displayed in the grid. TODO: The collection parameter needs
to be added.</p>

<p>Options:</p>
<ul><li>
<p>selected_items - items in the grid that should be selected when the grid is
rendered.</p>
</li></ul>
          
          

          
          <div class="method-source-code" id="grid-source">
            <pre><span class="ruby-comment"># File lib/gridzilla/dsl.rb, line 71</span>
      <span class="ruby-keyword">def</span> <span class="ruby-identifier">grid</span>(<span class="ruby-identifier">name</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
        <span class="ruby-identifier">options</span>    = <span class="ruby-identifier">args</span>.<span class="ruby-identifier">extract_options!</span>
        <span class="ruby-identifier">collection</span> = <span class="ruby-identifier">args</span>.<span class="ruby-identifier">shift</span>

        <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>, <span class="ruby-string">&quot;Missing collection in grid definition&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">collection</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">block_given?</span>

        <span class="ruby-identifier">grid_controller</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:controller</span>]

        <span class="ruby-keyword">if</span> <span class="ruby-identifier">name</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/\//</span>
          <span class="ruby-identifier">name_parts</span>      = <span class="ruby-identifier">name</span>.<span class="ruby-identifier">split</span>(<span class="ruby-regexp">/\//</span>)
          <span class="ruby-identifier">grid_controller</span> = <span class="ruby-identifier">name_parts</span>.<span class="ruby-identifier">first</span>
          <span class="ruby-identifier">name</span>            = <span class="ruby-identifier">name_parts</span>.<span class="ruby-identifier">last</span>
        <span class="ruby-keyword">end</span>
        <span class="ruby-identifier">grid_class</span> = <span class="ruby-identifier">options</span>[<span class="ruby-value">:class</span>] <span class="ruby-operator">||</span> <span class="ruby-string">&quot;gridzilla&quot;</span>
        <span class="ruby-identifier">data</span>       = <span class="ruby-identifier">options</span>[<span class="ruby-value">:data</span>] <span class="ruby-operator">||</span> {}

        <span class="ruby-keyword">unless</span> <span class="ruby-ivar">@gridzilla_script_loaded</span>
          <span class="ruby-identifier">main_script</span> =  <span class="ruby-value">&lt;&lt;-SCRIPT
            if (!gridzilla) { '';
              var gridzilla = {};

              (function(){

                var gridzilla_data = {};
                gridzilla.get_data = function(grid_name) {
                  return gridzilla_data[grid_name];
                }
                gridzilla.set_data = function(grid_name, data) {
                  gridzilla_data[grid_name] = data;
                }

                var gridzilla_is_loaded = {};
                gridzilla.is_loaded = function(grid_name) {
                  return gridzilla_is_loaded[grid_name];
                }
                gridzilla.set_loaded = function(grid_name) {
                  gridzilla_is_loaded[grid_name] = true;
                }
                gridzilla.set_unloaded = function(grid_name) {
                  gridzilla_is_loaded[grid_name] = false;
                }


                var gridzilla_options = {};
                gridzilla.get_option = function(grid_name, option_name) {
                  if (gridzilla_options[grid_name]) {
                    return gridzilla_options[grid_name][option_name];
                  }
                }
                gridzilla.set_option = function(grid_name, option_name, value) {
                  if (!gridzilla_options[grid_name]) {
                    gridzilla_options[grid_name] = {};
                  }
                  gridzilla_options[grid_name][option_name] = value;
                }

                gridzilla.setup = function(grid_name) {

                  if (gridzilla.get_option(grid_name, 'height') &amp;&amp; $(&quot;#&quot;+grid_name).is(&quot;:not(div &gt; .#{Gridzilla::Css::Empty})&quot;)) {
                    if ($(&quot;#&quot;+grid_name+&quot; .#{Gridzilla::Css::Table}:first&quot;).height() &gt; gridzilla.get_option(grid_name, 'height')) {
                      $(&quot;#&quot;+grid_name+&quot; .#{Gridzilla::Css::TableContainer}:first&quot;).height(gridzilla.get_option(grid_name, 'height')).fixedHeaderTable();
                      //$(&quot;#&quot;+grid_name+&quot; .#{Gridzilla::Css::Table}:first&quot;).Scrollable(gridzilla.get_option(grid_name, 'height'));
                    }
                  }

                  //Handle Check Boxes
                  $(&quot;#&quot;+grid_name+&quot;_select_all&quot;).click(function() {
                    if ($(&quot;#&quot;+grid_name+&quot; thead:first tr.ui-selected&quot;).length == 0) {
                      $(&quot;#&quot;+grid_name+&quot; tr&quot;).addClass(&quot;ui-selected&quot;).removeClass(&quot;ui-partial&quot;);
                      gridzilla.popup_multi_page_select(grid_name);
                    } else {
                      $(&quot;#&quot;+grid_name+&quot; tr&quot;).removeClass(&quot;ui-selected ui-partial&quot;);
                      gridzilla.deactivate_multi_page_select(grid_name);
                    }

                  });


                  $(&quot;#&quot;+grid_name+&quot; .#{Gridzilla::Css::TableContainer}:first thead:first .#{Gridzilla::Css::Sortable}&quot;).click(function() {
                    var column_header = $(this);
                    var sort_key      = $(&quot;input[name=sort_key]&quot;, this).val();

                    if (column_header.hasClass(&quot;#{Gridzilla::Css::SortAsc}&quot;)) {
                      var pagination_data = {sort_key: sort_key, sort_order: &quot;DESC&quot;};
                    } else if (column_header.hasClass(&quot;#{Gridzilla::Css::SortDesc}&quot;)) {
                      var pagination_data = {sort_key: &quot;&quot;, sort_order: &quot;&quot;};
                    } else {
                      var pagination_data = {sort_key: sort_key, sort_order: &quot;ASC&quot;, page: 1};
                    }

                    var new_gridzilla_data = $.extend(gridzilla.get_data(grid_name), pagination_data);

                    gridzilla.set_data(grid_name, new_gridzilla_data);
                    gridzilla.load(grid_name);
                  });

                  gridzilla.set_loaded(grid_name);
                };

                gridzilla.row_click = function(element) {
                  grid_name = $(element).parents('.gridzilla').get(0).id;

                  if ($(element).is(&quot;tr:has(.#{Gridzilla::Css::RadioButton})&quot;)) {
                    $(element).closest('.gridzilla').find(&quot;tr&quot;).removeClass(&quot;ui-selected&quot;);
                    $(element).addClass(&quot;ui-selected&quot;);
                  } else {
                    if ($(element).closest('tr').hasClass('ui-selected')){
                      gridzilla.deactivate_multi_page_select(grid_name);
                    }
                    $(element).toggleClass('ui-selected');
                    gridzilla.select_all_adorning($(element).closest('.gridzilla'), grid_name);
                  }

                };

                gridzilla.select_all_adorning = function(grid_jqo, grid_name) {
                  if ($(&quot;tbody td .#{Gridzilla::Css::Checkbox}&quot;, grid_jqo).length == $(&quot;tbody tr.ui-selected td .#{Gridzilla::Css::Checkbox}&quot;, grid_jqo).length) {
                    $(&quot;thead tr&quot;, grid_jqo).addClass('ui-selected');
                    $(&quot;thead tr&quot;, grid_jqo).removeClass('ui-partial');
                    gridzilla.popup_multi_page_select(grid_name);
                  } else if ($(&quot;tbody tr.ui-selected td .#{Gridzilla::Css::Checkbox}&quot;, grid_jqo).length == 0) {
                    $(&quot;thead tr&quot;, grid_jqo).removeClass('ui-selected');
                    $(&quot;thead tr&quot;, grid_jqo).removeClass('ui-partial');
                  } else {
                    $(&quot;thead tr&quot;, grid_jqo).removeClass('ui-selected');
                    $(&quot;thead tr&quot;, grid_jqo).addClass('ui-partial');
                  }
                };

                gridzilla.deselect_all = function(grid_name) {
                  $(&quot;#search_users .gz_table_container .fht_table_body .gz_table tbody tr&quot;).removeClass(&quot;ui-selected&quot;);
                  $(&quot;tr&quot;,'#'+grid_name).removeClass('ui-partial ui-selected');
                };

                gridzilla.selected_values = function(grid_name, attribute) {
                  if (gridzilla.get_option(grid_name,'multi_page_selected') &amp;&amp; gridzilla.get_option(grid_name,'total_records') &gt; 100){
                    x=gridzilla.get_data(grid_name);
                    a=[];
                    for(key in x){
                      if(x[key]!=''){
                        if ($.isArray(x[key]) &amp;&amp; !key.match(/.*\\[\\]$/)){
                          a.push('&quot;'+key+'[]&quot;:&quot;'+x[key]+'&quot;');
                        }else{
                          a.push('&quot;'+key+'&quot;:&quot;'+x[key]+'&quot;');
                        }
                      }
                    };
                    return {&quot;length&quot;:gridzilla.get_option(grid_name,'total_records'),join:function(charac){
                        return &quot;{current_user:&quot;+current_user_id+&quot;,current_school:&quot;+current_school_id+',count:'+gridzilla.get_option(grid_name,'total_records')+
                        &quot;,by:&quot;+gridzilla.get_option(grid_name,'multi_page_selector')+&quot;,filters:{&quot;+a.join(',')+'}}'
                      }}
                  } else {
                    return $.map($(&quot;#&quot;+grid_name+&quot; tr.ui-selected input[name=&quot;+grid_name+&quot;_select]&quot;), function(d) {
                      eval(&quot;var val = &quot;+$(d).val());
                      if (attribute) {
                        return [val[attribute]];
                      } else {
                        return [val];
                      }
                    });
                  }
                };

                gridzilla.popup_multi_page_select = function(grid_name){
                  $(&quot;#&quot;+grid_name+&quot;_multi_select&quot;).show();
                  $(&quot;.gz_multi_clear,&quot;+grid_name).click(function(){
                    gridzilla.deselect_all(grid_name);
                    gridzilla.deactivate_multi_page_select(grid_name)
                  });
                };

                gridzilla.activate_multi_page_select = function(grid_name){
                  $(&quot;.&quot;+grid_name+&quot;_multi_select&quot;).toggle();
                  gridzilla.set_option(grid_name,'multi_page_selected',true);
                  $(&quot;.gz_button&quot;).hide();
                  $(&quot;.multi_page_button&quot;).show();
                };

                gridzilla.deactivate_multi_page_select = function(grid_name){
                  gridzilla.set_option(grid_name,'multi_page_selected',false);
                  $(&quot;.&quot;+grid_name+&quot;_multi_select&quot;).show();
                  $(&quot;.&quot;+grid_name+&quot;_multi_select.select_all&quot;).hide();
                  $(&quot;#&quot;+grid_name+&quot;_multi_select&quot;).hide();
                  $(&quot;.gz_button&quot;).show();
                };

                gridzilla.values = function(grid_name, attribute) {
                  return gridzilla.selected_values(grid_name, attribute);
                };

                gridzilla.unload = function(grid_name) {
                  $('#'+grid_name).html('');
                  gridzilla.set_unloaded(grid_name);
                };

                gridzilla.block = function(grid_name, message) {
                  $(&quot;#&quot;+grid_name).block({
                    css: {
                           border: 'none',
                           padding: '10px',
                           backgroundColor: '#000',
                           '-webkit-border-radius': '5px',
                           '-moz-border-radius': '5px',
                           opacity: .7,
                           color: '#fff'
                         },
                    message: '&lt;div class=&quot;gz_load&quot;&gt;&lt;img src=&quot;/assets/gridzilla/red_blk_loader.gif&quot;/&gt;&lt;h2&gt;' + message + '&lt;/h2&gt;&lt;/div&gt;'
                  });
                }

                gridzilla.load = function(grid_name, options, callback) {
                  if (!gridzilla.get_option(grid_name, &quot;controller&quot;)) return;

                  if (grid_name &amp;&amp; $(&quot;#&quot;+grid_name).length &gt; 0) {
                    options = options || {};
                    var reload = true;

                    if (options.passive) {
                      if (gridzilla.is_loaded(grid_name)) {
                        reload = false;
                      } else {
                        reload = true;
                      }
                    }

                    if (reload) {
                      if ($(&quot;#&quot;+grid_name).is(':empty')) $(&quot;#&quot;+grid_name).html('&lt;div class=&quot;gz_load_spacer&quot;&gt;&lt;/div&gt;');
                      gridzilla.block(grid_name, 'Loading');
                      var grid_data = options.data || {};

                      if (options.keep_params) {
                        grid_data = merge(gridzilla.get_option(grid_name, &quot;params&quot;), grid_data);
                      }

                      for (attribute in gridzilla.get_data(grid_name)) {
                        if (grid_data[attribute] == undefined) {
                          grid_data[attribute] = gridzilla.get_data(grid_name)[attribute];
                        }
                      }

                      var grid_url = gridzilla.get_option(grid_name, &quot;url&quot;) || '/gridzilla/'+gridzilla.get_option(grid_name, &quot;controller&quot;)+'/'+grid_name+'_grid';


                      var data_str = (typeof(grid_data) === 'string') ? grid_data : $.param(grid_data, false);

                      $.get(grid_url, data_str, function(data) {
                        $('#'+grid_name).html(data);
                        gridzilla.setup(grid_name);
                        if (callback) callback();
                      });
                    }
                  }
                };

                gridzilla.action_function = function(function_name, grid_name, attribute, options) {
                  var selected_ids = gridzilla.values(grid_name, attribute);

                  var constraint_range = [1, Infinity];
                  if (options.selection_constraint == 'single') {
                    constraint_range = [1, 1];
                  } else if (options.selection_constraint instanceof Array) {
                    constraint_range = options.selection_constraint;
                  }

                  if (selected_ids.length &lt; constraint_range[0] || selected_ids.length &gt; constraint_range[1]) {
                    if (selected_ids.length == 0) {
                      alert(options.empty_message);
                    } else if (options.selection_constraint == 'single') {
                      alert(options.single_message);
                    } else if (constraint_range[1] == Infinity) {
                      alert('You must select ' + constraint_range[0] + ' or more items.');
                    } else {
                      alert('You must select ' + constraint_range[0] + '..' + constraint_range[1] + ' items.');
                    }
                  } else {
                    if (options.block_message) {
                      gridzilla.block(grid_name, options.block_message);
                    }

                    if (constraint_range[1] == 1) {
                      window[function_name](selected_ids[0]);
                    } else {
                      window[function_name](selected_ids);
                    }
                  }
                };

                gridzilla.add_class = function(element, css_class) {
                  $(element).addClass(css_class);
                };

                gridzilla.remove_class = function(element, css_class) {
                  $(element).removeClass(css_class);
                };

                var clone = function(obj) {
                  var copy = {};

                  for (attribute in obj) {
                    copy[attribute] = obj[attribute];
                  }

                  return copy;
                };

                var merge = function(first, second) {
                  var result = clone(first);

                  for (attribute in second) {
                    result[attribute] = second[attribute];
                  }

                  return result;
                };

              })();
            }
          SCRIPT</span>
          <span class="ruby-identifier">concat</span>(<span class="ruby-identifier">content_tag</span>(<span class="ruby-value">:script</span>,<span class="ruby-identifier">main_script</span>.<span class="ruby-identifier">html_safe</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-keyword">false</span>))
          <span class="ruby-ivar">@gridzilla_script_loaded</span> = <span class="ruby-keyword">true</span>
        <span class="ruby-keyword">end</span>

        <span class="ruby-identifier">concat</span>(<span class="ruby-identifier">content_tag</span>(<span class="ruby-value">:script</span>, <span class="ruby-string">&quot;          gridzilla.set_data('#{name.html_safe}', #{data.to_json.html_safe});
          #{&quot;gridzilla.set_option('#{name.html_safe}', 'height', #{options[:height].to_json.html_safe});&quot; if options[:height]}
        #{&quot;gridzilla.set_option('#{name.html_safe}', 'url', #{options[:url].to_json.html_safe});&quot; if options[:url]}
&quot;</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-keyword">false</span>))

        <span class="ruby-keyword">if</span> <span class="ruby-identifier">block_given?</span>
          <span class="ruby-ivar">@gridzilla</span> <span class="ruby-operator">||=</span> []
          <span class="ruby-ivar">@gridzilla</span>.<span class="ruby-identifier">push</span>({})
          <span class="ruby-ivar">@gridzilla</span>.<span class="ruby-identifier">last</span>[<span class="ruby-value">:grid_name</span>]       = <span class="ruby-identifier">name</span>
          <span class="ruby-ivar">@gridzilla</span>.<span class="ruby-identifier">last</span>[<span class="ruby-value">:grid_controller</span>] = <span class="ruby-identifier">grid_controller</span>
          <span class="ruby-ivar">@gridzilla</span>.<span class="ruby-identifier">last</span>[<span class="ruby-value">:collection</span>]      = <span class="ruby-identifier">collection</span>
          <span class="ruby-ivar">@gridzilla</span>.<span class="ruby-identifier">last</span>[<span class="ruby-value">:selected_items</span>]  = <span class="ruby-identifier">options</span>[<span class="ruby-value">:selected_items</span>]

          <span class="ruby-identifier">concat</span>(<span class="ruby-identifier">tag</span>(<span class="ruby-value">:div</span>, {<span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">name</span>, <span class="ruby-value">:class</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">grid_class</span>}, <span class="ruby-keyword">true</span>))
          <span class="ruby-identifier">view_dsl</span> = <span class="ruby-constant">Gridzilla</span><span class="ruby-operator">::</span><span class="ruby-constant">ViewDsl</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">new</span>(<span class="ruby-constant">Gridzilla</span><span class="ruby-operator">::</span><span class="ruby-constant">View</span><span class="ruby-operator">::</span><span class="ruby-constant">Grid</span>.<span class="ruby-identifier">new</span>(<span class="ruby-keyword">self</span>), <span class="ruby-keyword">self</span>)
          <span class="ruby-identifier">view_dsl</span>.<span class="ruby-identifier">instance_eval</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
          <span class="ruby-identifier">concat</span>(<span class="ruby-string">'&lt;/div&gt;'</span>)

          <span class="ruby-identifier">concat</span>(<span class="ruby-identifier">content_tag</span>(<span class="ruby-value">:script</span>, <span class="ruby-string">&quot;            setTimeout(function() {
              gridzilla.setup('#{name.html_safe}');
              gridzilla.set_option('#{name.html_safe}', 'controller', #{grid_controller.to_json.html_safe});
              gridzilla.set_option('#{name.html_safe}', 'params', #{request.query_parameters.to_json.html_safe});
              gridzilla.set_option('#{name.html_safe}', 'single_select', #{(!!@gridzilla.last[:single_select]).to_json.html_safe});
              gridzilla.set_option('#{@gridzilla.last[:grid_name].html_safe}', 'multi_page_selected', false);
            }, 0);
&quot;</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-keyword">false</span>))

          <span class="ruby-ivar">@gridzilla</span>.<span class="ruby-identifier">pop</span>
        <span class="ruby-keyword">else</span>
          <span class="ruby-identifier">concat</span>(<span class="ruby-identifier">content_tag</span>(<span class="ruby-value">:div</span>, <span class="ruby-string">&quot;&quot;</span>, <span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">name</span>, <span class="ruby-value">:class</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">grid_class</span>))
          <span class="ruby-keyword">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:lazy</span>]
            <span class="ruby-identifier">concat</span>(<span class="ruby-identifier">content_tag</span>(<span class="ruby-value">:script</span>, <span class="ruby-string">&quot;              $(function() {
                gridzilla.set_option('#{name.html_safe}', 'controller', #{grid_controller.to_json.html_safe});
              });
&quot;</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-keyword">false</span>))
          <span class="ruby-keyword">else</span>
            <span class="ruby-identifier">concat</span>(<span class="ruby-identifier">content_tag</span>(<span class="ruby-value">:script</span>, <span class="ruby-string">&quot;              $(function() {
                gridzilla.set_option('#{name.html_safe}', 'controller', #{grid_controller.to_json.html_safe});
                gridzilla.load('#{name}');
              });
&quot;</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-keyword">false</span>))
          <span class="ruby-keyword">end</span>

          <span class="ruby-keyword">if</span> <span class="ruby-constant">Rails</span>.<span class="ruby-identifier">env</span>.<span class="ruby-identifier">development?</span>
            <span class="ruby-identifier">concat</span>(<span class="ruby-identifier">content_tag</span>(<span class="ruby-value">:div</span>, <span class="ruby-identifier">content_tag</span>(<span class="ruby-value">:a</span>, <span class="ruby-string">'reload grid'</span>, <span class="ruby-value">:href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'#'</span>, <span class="ruby-value">:onclick</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;gridzilla.load('#{name.html_safe}')&quot;</span>, <span class="ruby-value">:class</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'reload_link'</span>), <span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;#{name}_reloader&quot;</span>))
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span></pre>
          </div><!-- grid-source -->
          
        </div>

        

        
      </div><!-- grid-method -->

    
    </section><!-- public-instance-method-details -->
  
  </section><!-- 5Buntitled-5D -->

</div><!-- documentation -->


<footer id="validator-badges">
  <p><a href="http://validator.w3.org/check/referer">[Validate]</a>
  <p>Generated by <a href="https://github.com/rdoc/rdoc">RDoc</a> 4.0.1.
  <p>Generated with the <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish Rdoc Generator</a> 3.
</footer>

